<section class='container'>
	<section class='row'>
		<div class='col-12'>
			<h3 class='page-title'>Insurance Plans</h3>
			<%= render 'partials/query' %>
			<%= render 'partials/pagination', resource: :insurance_plans %>
		</div>
		<div class='col-12'>
			<div class="accordion mb-4" id="searchAccordion">
				<div class="accordion-item">
					<h2 class="accordion-header" id="headingOne">
						<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
							Search
						</button>
					</h2>
					<div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#searchAccordion">
						<div class="accordion-body">
							<%= render 'partials/search_form',
									   query_params: @query_params,
									   search_path: insurance_plans_path
							%>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class='col-12'>
			<table class='table table-dark table-striped'>
				<thead>
					<tr>
						<th scope='col'>Name</th>
						<th scope='col'>Owned By</th>
						<th scope='col'>Administered By</th>
						<th scope='col'>Coverage Areas</th>
						<th scope='col'>Type</th>
						<th scope='col'>Networks</th>
					</tr>
				</thead>
				<tbody>
					<% @insurance_plans.each do |fhir_insurance_plan| %>
						<% insurance_plan = InsurancePlan.new(fhir_insurance_plan) %>
						<tr>
							<td><%= link_to sanitize(insurance_plan.name), insurance_plan_path(insurance_plan.id) %></td>
							<td><%= display_reference(insurance_plan.owned_by) %></td>
							<td><%= display_reference(insurance_plan.administered_by) %></td>
							<td><%= sanitize(insurance_plan.coverage_areas.map(&:display).join(', ')) %></td>
							<td><%= insurance_plan.type.map(&:text).join(',') %></td>
							<td>
								<% insurance_plan.networks.each do |network| %>
									<%= display_reference(network) %><br>
								<% end %>
							</td>
						</tr>
					<% end %>
				</tbody>
			</table>
		</div>
		<div class='col-12'>
			<%= render 'partials/pagination', resource: :insurance_plans, header: false %>
		</div>
	</section>
</section>
